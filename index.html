<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smart RAG Workspace (Tokenless)</title>
  <link rel="stylesheet" href="./style.css" />
  <!-- Minimal deps (IndexedDB, BM25, PDF) -->
  <script src="https://cdn.jsdelivr.net/npm/localforage@1.10.0/dist/localforage.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/elasticlunr/elasticlunr.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@4.7.76/build/pdf.min.js"></script>
  <script>
    window['pdfjs-dist/build/pdf'].GlobalWorkerOptions.workerSrc =
      'https://cdn.jsdelivr.net/npm/pdfjs-dist@4.7.76/build/pdf.worker.min.js';
  </script>
</head>
<body>
<div class="app">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-top">
      <button id="btn-new-room" class="btn primary block">+ 새 룸</button>
    </div>
    <div class="sidebar-label">Rooms</div>
    <div id="room-list" class="room-list"></div>
  </aside>

  <!-- Main -->
  <main class="main">
    <header class="topbar">
      <div class="l">
        <h1 class="brand">Smart RAG Workspace</h1>
        <span id="gpu" class="chip"></span>
      </div>
      <div class="r">
        <button id="btn-upload" class="btn">업로드</button>
        <button id="btn-settings" class="btn accent">설정</button>
        <button id="btn-clear-chat" class="btn">히스토리 삭제</button>
      </div>
    </header>

    <div class="grid">
      <!-- Chat -->
      <section class="card chat">
        <div id="messages" class="messages">
          <div class="empty">
            <div class="icon">💬</div>
            <div class="title">문서를 업로드하고 질문해 보세요</div>
            <div class="desc">좌측에서 새 룸을 만들고, 상단 “업로드”로 파일을 추가한 뒤 인덱싱 없이도 FAST 모드로 검색이 가능합니다.</div>
          </div>
        </div>
        <div class="composer">
          <textarea id="q" rows="1" placeholder="문서 기반 질문을 입력하고 Enter"></textarea>
          <button id="btn-ask" class="btn primary">질의</button>
        </div>
        <div class="tiny">
          모드:
          <select id="mode">
            <option value="hybrid" selected>HYBRID (추천)</option>
            <option value="fast">FAST (BM25)</option>
            <option value="full">FULL (사전 임베딩 필요)</option>
          </select>
          · TopK <span id="kShow">4</span>
        </div>
      </section>

      <!-- Status -->
      <aside class="stack">
        <section class="card">
          <div class="card-title">상태</div>
          <ul id="status" class="status"></ul>
          <div class="tiny muted">* 생성형 LLM 없이도 동작합니다(FAST/HYBRID).</div>
        </section>
        <section class="card">
          <div class="card-title">퍼포먼스</div>
          <div class="metrics">
            <div class="metric">
              <div id="perf-docs" class="metric-num">0</div>
              <div class="metric-cap">문서</div>
            </div>
            <div class="metric">
              <div id="perf-chunks" class="metric-num">0</div>
              <div class="metric-cap">총 청크</div>
            </div>
          </div>
        </section>
        <section class="card">
          <div class="card-title">소스</div>
          <div id="files" class="tiny muted">없음</div>
        </section>
      </aside>
    </div>
  </main>
</div>

<!-- Upload Modal -->
<div id="modal-upload" class="modal hidden">
  <div class="dialog">
    <div class="dialog-head">
      <div class="dialog-title">문서 업로드</div>
      <button data-close="modal-upload" class="icon-btn">✕</button>
    </div>
    <div id="drop" class="drop">
      <div class="drop-icon">⛅</div>
      <div>여기로 드래그하거나 클릭해 선택</div>
      <div class="tiny muted">TXT, MD, PDF</div>
      <input id="file" type="file" accept=".txt,.md,.pdf" multiple class="hidden">
    </div>
    <div id="pdf-status" class="tiny muted" style="margin-top:8px;"></div>
    <div class="dialog-foot">
      <button data-close="modal-upload" class="btn">닫기</button>
      <button id="btn-index" class="btn primary" disabled>인덱싱</button>
    </div>
  </div>
</div>

<!-- Settings Modal -->
<div id="modal-settings" class="modal hidden">
  <div class="dialog">
    <div class="dialog-head">
      <div class="dialog-title">설정</div>
      <button data-close="modal-settings" class="icon-btn">✕</button>
    </div>
    <div class="form">
      <label>청크 전략
        <select id="chunking">
          <option value="semantic">Semantic</option>
          <option value="sentence">Sentence-based</option>
          <option value="fixed" selected>Fixed Size</option>
        </select>
      </label>
      <div class="row">
        <label>청크 크기
          <input id="chunkSize" type="number" min="200" max="2000" step="100" value="900">
        </label>
        <label>오버랩
          <input id="overlap" type="number" min="0" max="500" step="50" value="150">
        </label>
      </div>
      <label>검색 결과 개수(TopK)
        <input id="searchK" type="number" min="1" max="10" value="4">
      </label>
    </div>
    <div class="dialog-foot">
      <button data-close="modal-settings" class="btn">닫기</button>
      <button id="btn-save-settings" class="btn accent">저장</button>
    </div>
  </div>
</div>

<script type="module" src="./script.js"></script>
</body>
</html>
